! Complie and execute with:
!   $ gfortran gauss_quad.f90 -o quad
!   $ ./quad 
program quadrature
  implicit none

    ! Declare variables
    integer(4), parameter :: n2 = 2, n4 = 4, n8 = 8, n16 = 16, n32 = 32
    real(8), parameter    :: pi = 4.D0 * atan(1.D0)
    integer(4)  :: i
    real(8)     :: r, m, c
    real(8)     :: a, b, result2, result4, result8, result16, result32
    !real(8)     :: start_time, end_time
    real(8), dimension (n2)   :: x2, w2
    real(8), dimension (n4)   :: x4, w4
    real(8), dimension (n8)   :: x8, w8
    real(8), dimension(n16)   :: x16, w16
    real(8), dimension(n32)   :: x32, w32

    ! Define the limits of integration
    a = -10.D0
    b = 10.D0

    ! Define the abscissas and weights for 2-point Gauss quadrature
    data x2 /-0.5773502691896257D0, 0.5773502691896257D0/
    data w2 / 1.0000000000000000D0, 1.0000000000000000D0/

    ! Define the abscissas and weights for 4-point Gauss quadrature
    data x4 /-0.3399810435848563D0, 0.3399810435848563D0, -0.8611363115940526D0, 0.8611363115940526D0/
    data w4 / 0.6521451548625461D0, 0.6521451548625461D0,  0.3478548451374538D0, 0.3478548451374538D0/ 

    ! Define the abscissas and weights for 8-point Gauss quadrature
    data x8 /-0.1834346424956498D0, 0.1834346424956498D0, -0.5255324099163290D0, 0.5255324099163290D0, &
             -0.7966664774136267D0, 0.7966664774136267D0, -0.9602898564975363D0, 0.9602898564975363D0/
    data w8 / 0.3626837833783620D0, 0.3626837833783620D0, 0.3137066458778873D0, 0.3137066458778873D0, &
              0.2223810344533745D0, 0.2223810344533745D0, 0.1012285362903763D0, 0.1012285362903763D0/ 

    ! Define the abscissas and weights for 16-point Gauss quadrature
    data x16 /-0.0950125098376374D0, 0.0950125098376374D0, -0.2816035507792589D0, 0.2816035507792589D0, &  
              -0.4580167776572274D0, 0.4580167776572274D0, -0.6178762444026438D0, 0.6178762444026438D0, &  
              -0.7554044083550030D0, 0.7554044083550030D0, -0.8656312023878318D0, 0.8656312023878318D0, &  
              -0.9445750230732326D0, 0.9445750230732326D0, -0.9894009349916499D0, 0.9894009349916499D0  /  
              
    data w16 /0.1894506104550685D0, 0.1894506104550685D0, 0.1826034150449236D0, 0.1826034150449236D0, &
              0.1691565193950025D0, 0.1691565193950025D0, 0.1495959888165767D0, 0.1495959888165767D0, &
              0.1246289712555339D0, 0.1246289712555339D0, 0.0951585116824928D0, 0.0951585116824928D0, &
              0.0622535239386479D0, 0.0622535239386479D0, 0.0271524594117541D0, 0.0271524594117541D0  /

    ! Define the abscissas and weights for 32-point Gauss quadrature
    data x32 /  -0.0483076656877383D0,	0.0483076656877383D0,   -0.144471961582797D0,	0.144471961582797D0,    &	
                -0.239287362252137D0,	0.239287362252137D0	,   -0.331868602282128D0,	0.331868602282128D0,    &	
                -0.421351276130635D0,	0.421351276130635D0	,   -0.506899908932229D0,	0.506899908932229D0,    &	
                -0.587715757240762D0,	0.587715757240762D0	,   -0.663044266930215D0,	0.663044266930215D0,    &	
                -0.73218211874029D0	 ,  0.73218211874029D0	,   -0.794483795967942D0,	0.794483795967942D0,    &	
                -0.84936761373257D0	 ,  0.84936761373257D0	,   -0.896321155766052D0,	0.896321155766052D0,    &	
                -0.93490607593774D0	 ,  0.93490607593774D0	,   -0.964762255587506D0,	0.964762255587506D0,    &	
                -0.985611511545268D0,	0.985611511545268D0	,   -0.997263861849482D0,	0.997263861849482D0 /

    data w32 /  0.0965400885147278D0,	0.0965400885147278D0,	0.0956387200792749D0,	0.0956387200792749D0,	&
                0.0938443990808046D0,	0.0938443990808046D0,	0.0911738786957639D0,	0.0911738786957639D0,	&
                0.0876520930044038D0,	0.0876520930044038D0,	0.0833119242269467D0,	0.0833119242269467D0,	&
                0.0781938957870703D0,	0.0781938957870703D0,	0.0723457941088485D0,	0.0723457941088485D0,	&
                0.0658222227763618D0,	0.0658222227763618D0,	0.0586840934785355D0,	0.0586840934785355D0,	&
                0.0509980592623762D0,	0.0509980592623762D0,	0.0428358980222267D0,	0.0428358980222267D0,	&
                0.0342738629130214D0,	0.0342738629130214D0,	0.0253920653092621D0,	0.0253920653092621D0,	&
                0.0162743947309057D0,	0.0162743947309057D0,	0.0070186100094701D0,	0.0070186100094701D0/


    ! Compute the results using 8-point and 16-point Gauss quadrature
    r = 0.D0
    m = (b-a)/2.D0
    c = (b+a)/2.D0
    result2  = 0.D0
    result4  = 0.D0
    result8  = 0.D0
    result16 = 0.D0
    result16 = 0.D0
    do i = 1, n2
        result2 = result2 + w2(i) * f(m*x2(i) + c)
    end do
    result2 = result2*m
    do i = 1, n4
        result4 = result4 + w4(i) * f(m*x4(i) + c)
    end do
    result4 = result4*m
    do i = 1, n8
        result8 = result8 + w8(i) * f(m*x8(i) + c)
    end do
    result8 = result8*m
    do i = 1, n16
        result16 =  result16 + w16(i) * f(m*x16(i) + c)
    end do
    result16 = result16*m
    do i = 1, n32
        result32 =  result32 + w32(i) * f(m*x32(i) + c)
    end do
    result32 = result32*m
    ! Print the results
    print *, "Result using 2-point Gauss quadrature: ", result2
    print *, "Result using 4-point Gauss quadrature: ", result4
    print *, "Result using 8-point Gauss quadrature: ", result8
    print *, "Result using 16-point Gauss quadrature: ", result16
    print *, "Result using 32-point Gauss quadrature: ", result32

    

    contains

    ! Function to be integrated
    real(8) function f(x)
        real(8), intent(in) :: x
        !f = x**2.D0
        !f = (sin(x))**2+2*(sin(2*x))**4
        f = exp(-x*x)
    end function

end program

function gauss16(f,a,b)
    !==========================================================
    ! Integration of f(x) on [a,b]
    ! Method: Gauss 16 points  
    ! written by: Alex Godunov (October 2009)
    !----------------------------------------------------------
    ! IN:
    ! f   - Function to integrate (supplied by a user)
    ! a	  - Lower limit of integration
    ! b	  - Upper limit of integration
    ! OUT:
    ! gauss16 - Result of integration
    !==========================================================
    implicit none
    integer(8), parameter :: n = 8
    real(8)    :: gauss16, f, a, b
    real(8)    :: ti(n), ci(n)
    data ti/0.0950125098, 0.2816035507, 0.4580167776, 0.6178762444, &  
            0.7554044083, 0.8656312023, 0.9445750230, 0.9894009349/ 
    data ci/0.1894506104, 0.1826034150, 0.1691565193, 0.1495959888, &
            0.1246289712, 0.0951585116, 0.0622535239, 0.0271524594/ 
    real(8)    :: r, m, c
    integer(8) :: i
    
    r = 0.0;
    m = (b-a)/2.0;
    c = (b+a)/2.0;
    
    do i = 1, n 
        r = r + ci(i)*(f(m*(-1.0)*ti(i) + c) + f(m*ti(i) + c))
    end do
    gauss16 = r*m
    return
end function gauss16

function gauss32(f,a,b)
    !==========================================================
    ! Integration of f(x) on [a,b]
    ! Method: Gauss 32 points  
    !----------------------------------------------------------
    ! IN:
    ! f   - Function to integrate (supplied by a user)
    ! a	  - Lower limit of integration
    ! b	  - Upper limit of integration
    ! OUT:
    ! gauss32 - Result of integration
    !==========================================================
    implicit none
    integer(8), parameter :: n = 32
    real(8)    :: gauss16, f, a, b
    real(8)    :: x32(n), w32(n)
    ! Define the abscissas and weights for 32-point Gauss quadrature
    data x32 /  -0.0483076656877383D0,	0.0483076656877383D0,   -0.144471961582797D0,	0.144471961582797D0,    &	
                -0.239287362252137D0,	0.239287362252137D0	,   -0.331868602282128D0,	0.331868602282128D0,    &	
                -0.421351276130635D0,	0.421351276130635D0	,   -0.506899908932229D0,	0.506899908932229D0,    &	
                -0.587715757240762D0,	0.587715757240762D0	,   -0.663044266930215D0,	0.663044266930215D0,    &	
                -0.73218211874029D0	 ,  0.73218211874029D0	,   -0.794483795967942D0,	0.794483795967942D0,    &	
                -0.84936761373257D0	 ,  0.84936761373257D0	,   -0.896321155766052D0,	0.896321155766052D0,    &	
                -0.93490607593774D0	 ,  0.93490607593774D0	,   -0.964762255587506D0,	0.964762255587506D0,    &	
                -0.985611511545268D0,	0.985611511545268D0	,   -0.997263861849482D0,	0.997263861849482D0 /

    data w32 /  0.0965400885147278D0,	0.0965400885147278D0,	0.0956387200792749D0,	0.0956387200792749D0,	&
                0.0938443990808046D0,	0.0938443990808046D0,	0.0911738786957639D0,	0.0911738786957639D0,	&
                0.0876520930044038D0,	0.0876520930044038D0,	0.0833119242269467D0,	0.0833119242269467D0,	&
                0.0781938957870703D0,	0.0781938957870703D0,	0.0723457941088485D0,	0.0723457941088485D0,	&
                0.0658222227763618D0,	0.0658222227763618D0,	0.0586840934785355D0,	0.0586840934785355D0,	&
                0.0509980592623762D0,	0.0509980592623762D0,	0.0428358980222267D0,	0.0428358980222267D0,	&
                0.0342738629130214D0,	0.0342738629130214D0,	0.0253920653092621D0,	0.0253920653092621D0,	&
                0.0162743947309057D0,	0.0162743947309057D0,	0.0070186100094701D0,	0.0070186100094701D0/
    real(8)    :: r, m, c
    integer(8) :: i
    
    r = 0.0;
    m = (b-a)/2.0;
    c = (b+a)/2.0;
    
    do i = 1, n32
        result32 =  result32 + w32(i) * f(m*x32(i) + c)
    end do
    result32 = result32*m
    return
end function gauss32